services:
  radar:
    image: ${RADAR_IMAGE:-dhomane/radar:0.9.12}
    container_name: ${RADAR_CONTAINER_NAME:-radar}
    restart: unless-stopped
    command:
      - --no-browser
      - --port
      - "${RADAR_PORT:-8585}"
    ports:
      - "${RADAR_PORT:-8585}:${RADAR_PORT:-8585}"
    environment:
      # Required by Helm operations in read-only style environments
      HELM_CACHE_HOME: /tmp/helm/cache
      HELM_CONFIG_HOME: /tmp/helm/config
      HELM_DATA_HOME: /tmp/helm/data
      # Ensure client-go + exec auth plugin use mounted host config paths
      KUBECONFIG: /home/nonroot/.kube/config
      CLOUDSDK_CONFIG: /home/nonroot/.config/gcloud
    volumes:
      # Mount your kubeconfig so Radar can connect to your cluster
      - ${KUBECONFIG_PATH:-${HOME}/.kube/config}:/home/nonroot/.kube/config:ro
      # Mount gcloud config for GKE exec auth plugin credentials (RW for token refresh)
      - ${GCLOUD_CONFIG_PATH:-${HOME}/.config/gcloud}:/home/nonroot/.config/gcloud
    read_only: true
    tmpfs:
      - /tmp
